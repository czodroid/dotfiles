#!/bin/sh
#
# Filename: config-debian-preseed
# Author: Olivier Sirol <czo@free.fr>
# License: GPL-2.0
# File Created: August 2020
# Last Modified: samedi 28 novembre 2020, 00:05
# Edit Time: 0:42:08
# Description:
#
#   debian preseed/late_command, single or double quote forbiden in pxe/append
#
# label Install Debian 10
#   menu default
#   kernel /boot/debian/debian-10-buster-linux-64
#   append initrd=/boot/debian/debian-10-buster-initrd-64 debian-installer/language=en debian-installer/country=US keyboard-configuration/xkb-keymap=us netcfg/get_hostname=unassigned-hostname netcfg/get_domain=unassigned-domain mirror/country=manual mirror/http/hostname=deb.debian.org mirror/http/directory=/debian mirror/http/proxy= popularity-contest/participate=false time/zone=Etc/UTC passwd/root-password=toor passwd/root-password-again=toor passwd/make-user=false partman-auto/disk=/dev/sda partman-auto/method=regular partman-auto/choose_recipe=atomic partman-partitioning/confirm_write_new_label=true partman/choose_partition=finish partman/confirm=true grub-installer/only_debian=true grub-installer/bootdev=/dev/sda finish-install/reboot_in_progress= tasksel:tasksel/first=standard pkgsel/include=openssh-server,aptitude,rsync,tmux,curl preseed/late_command="sed -i s/prohibit-password/yes/ /target/etc/ssh/sshd_config; sed -i s/#PermitRootLogin/PermitRootLogin/ /target/etc/ssh/sshd_config; wget -qO- https://git.io/JkHdk | sh;"
#   
#
# $Id: config-debian-preseed,v 1.5 2020/11/27 23:06:04 czo Exp $

#perl -i -pe 's,^#?PermitRootLogin.*,PermitRootLogin yes,' /target/etc/ssh/sshd_config;

echo $(date +%Y-%m-%d) > /target/etc/lsb-czo-installdate
echo $(date +%Y%m%d) > /target/etc/lsb-czo-updatedate

cd /target/root;
for f in .Xresources .bashrc .cvsrc .inputrc .profile .screenrc .tmux.conf .vimrc .zshrc czolsb
do
  wget -q https://raw.githubusercontent.com/czodroid/dotfiles/master/$f -O $f
done
chmod +x czolsb

export HOME=/target/root;
wget -qO- https://raw.githubusercontent.com/czodroid/dotfiles/master/config-fast-ssh  | sh

in-target sh -c "/root/czolsb > /etc/motd"

in-target sh -c "ln -fs /usr/share/zoneinfo/Etc/UTC /etc/localtime ; dpkg-reconfigure -f noninteractive tzdata"

in-target sh -c "perl -i -pe 's,# en_US.UTF-8 UTF-8,en_US.UTF-8 UTF-8,' /etc/locale.gen; perl -i -pe 's,# fr_FR.UTF-8 UTF-8,fr_FR.UTF-8 UTF-8,' /etc/locale.gen; update-locale LANG=en_US.UTF-8"


